<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live ISS Location - Multi-View Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Live ISS Location (Kafka + Flink Demo)</h1>
        <div id="status" class="status disconnected">Connecting to WebSocket...</div>
        
        <!-- Tab Navigation -->
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-view="raw-data">Raw Data</button>
                <button class="tab-button" data-view="windowed-count">Windowed Count</button>
                <button class="tab-button" data-view="derived-metric">Derived Metrics</button>
                <button class="tab-button" data-view="aggregated-position">Aggregated Position</button>
            </div>
        </div>

        <!-- View Containers -->
        <div id="raw-data-view" class="view-container active"></div>
        <div id="windowed-count-view" class="view-container"></div>
        <div id="derived-metric-view" class="view-container"></div>
        <div id="aggregated-position-view" class="view-container"></div>
    </div>

    <!-- Load scripts in order -->
    <script src="data-manager.js"></script>
    <script src="raw-data-view.js"></script>
    <script src="windowed-count-view.js"></script>
    <script src="derived-metric-view.js"></script>
    <script src="aggregated-position-view.js"></script>
    <script>
        // Initialize views
        const rawDataView = new RawDataView('raw-data-view');
        const windowedCountView = new WindowedCountView('windowed-count-view');
        const derivedMetricView = new DerivedMetricView('derived-metric-view');
        const aggregatedPositionView = new AggregatedPositionView('aggregated-position-view');

        // Current active view
        let activeView = rawDataView;

        // Tab button elements
        const tabButtons = document.querySelectorAll('.tab-button');
        const statusDiv = document.getElementById('status');

        /**
         * Switch to a different view
         */
        function switchView(viewName) {
            // Hide all views
            rawDataView.hide();
            windowedCountView.hide();
            derivedMetricView.hide();
            aggregatedPositionView.hide();

            // Remove active class from all tabs
            tabButtons.forEach(btn => btn.classList.remove('active'));

            // Show selected view
            switch(viewName) {
                case 'raw-data':
                    activeView = rawDataView;
                    rawDataView.show();
                    document.querySelector('[data-view="raw-data"]').classList.add('active');
                    break;
                case 'windowed-count':
                    activeView = windowedCountView;
                    windowedCountView.show();
                    document.querySelector('[data-view="windowed-count"]').classList.add('active');
                    break;
                case 'derived-metric':
                    activeView = derivedMetricView;
                    derivedMetricView.show();
                    document.querySelector('[data-view="derived-metric"]').classList.add('active');
                    break;
                case 'aggregated-position':
                    activeView = aggregatedPositionView;
                    aggregatedPositionView.show();
                    document.querySelector('[data-view="aggregated-position"]').classList.add('active');
                    break;
            }
        }

        // Set up tab button click handlers
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const viewName = button.getAttribute('data-view');
                switchView(viewName);
            });
        });

        // Register status callback
        dataManager.onStatusUpdate((message, status) => {
            statusDiv.textContent = message;
            statusDiv.className = `status ${status}`;
        });

        // Register all views as listeners
        dataManager.addListener((location) => {
            rawDataView.onDataReceived(location);
            windowedCountView.onDataReceived(location);
            derivedMetricView.onDataReceived(location);
            aggregatedPositionView.onDataReceived(location);
        });

        // Initialize WebSocket connection
        dataManager.connectWebSocket();

        // Show initial view
        rawDataView.show();
    </script>
</body>
</html>
